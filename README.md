# AVR Thermostat (ATtiny13 + DS18B20)

## Назначение

Прошивка предназначена для работы в качестве термостата с датчиками температуры DS18B20.
Используется для управления вентилятором обдува радиаторов.

Поддерживается подключение до 4 датчиков температуры на одной шине 1-Wire.

Система контролирует температуру и управляет вентиляторами по алгоритму с гистерезисом.
Выход рассчитан до 2 А на вентиляторы, питание от 8 до 28 В.

При необходимости доступен UART-выход для контроля работы устройства и логирования температуры и состояния реле.

---

## Используемые пины микроконтроллера

| Пин | Обозначение | Назначение                                        |
| --- | ----------- | ------------------------------------------------- |
| PB3 | PIN_DS1820  | Подключение датчиков температуры DS18B20 (1-Wire) |
| PB4 | PIN_RELAY   | Управление реле                                   |
| PB2 | PIN_UART_TX | Передача данных по UART                           |

---

## Подключение

### 1. Датчики температуры DS18B20

* Сигнальный провод подключается к пину PB3
* Требуется подтягивающий резистор 4.7 кОм между линией данных и питанием
* Поддерживается до 4 датчиков на одной шине 1-Wire

### 2. Управление транзистором

* Управляющий сигнал подключается к пину PB4
* Транзистор открывается высоким уровнем сигнала

### 3. UART

* Передающая линия TX подключается к пину PB2
* Скорость: 9600 бод
* Формат: 8N1
* UART необязателен и используется при необходимости для контроля и логирования

---

## Принцип работы

1. При запуске система ищет подключённые датчики DS18B20 (до 4 шт.)
2. Если датчики не найдены — по UART отправляется символ `N`, работа останавливается
3. Система циклически опрашивает все найденные датчики
4. Температура передаётся по UART в формате:

```
[номер_датчика]:[температура]
```

5. Управление реле осуществляется по гистерезису
6. Состояние реле передаётся по UART в формате:

```
R:[0/1]
```

---

## Детальная логика управления реле

### Гистерезис

* Верхний порог: 45°C
* Нижний порог: 40°C
* Гистерезис: 5°C

Если температура находится в диапазоне 40–45°C, состояние реле не изменяется.

> Примечание:
> При необходимости пороговые температуры можно изменить в файле main.c и перекомпилировать, установив свои значения под конкретное применение.

Прошивка для контроллера находится в файле:
`FIRMWARE/Release/GccApplication1.hex`

---

## Формат вывода UART

Температура:

```
[номер_датчика]:[температура]
```

Состояние реле:

```
R:[0/1]
```

Ошибка:

```
N
```

Отправляется, если датчики DS18B20 не обнаружены.

---

## Инструменты

* Микроконтроллер: ATtiny13
* Компилятор / IDE: Microchip Studio
* САПР платы: DipTrace
